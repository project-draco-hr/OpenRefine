{
  for (  OverlayModel overlayModel : overlayModels.values()) {
    try {
      overlayModel.onBeforeSave();
    }
 catch (    Exception e) {
      logger.warn("Error signaling overlay model before saving",e);
    }
  }
  Writer writer=new OutputStreamWriter(out);
  try {
    Properties options=new Properties();
    options.setProperty("mode","save");
    options.put("pool",pool);
    saveToWriter(writer,options);
  }
  finally {
    writer.flush();
  }
  for (  OverlayModel overlayModel : overlayModels.values()) {
    try {
      overlayModel.onAfterSave();
    }
 catch (    Exception e) {
      logger.warn("Error signaling overlay model after saving",e);
    }
  }
}
