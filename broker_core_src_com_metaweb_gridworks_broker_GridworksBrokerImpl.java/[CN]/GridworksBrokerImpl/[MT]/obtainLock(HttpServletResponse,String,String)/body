{
  Transaction txn=env.beginTransaction(null,null);
  Lock lock=getLock(pid);
  if (lock == null) {
    try {
      lock=new Lock(Long.toHexString(txn.getId()),pid,uid);
      lockByProject.put(txn,lock);
      txn.commit();
    }
  finally {
      if (txn != null) {
        txn.abort();
        txn=null;
      }
    }
  }
  respond(response,lockToJSON(lock));
}
