{
  String data_dir=Configurations.get("refine.data_dir");
  if (data_dir != null) {
    return data_dir;
  }
  File dataDir=null;
  String os=System.getProperty("os.name").toLowerCase();
  if (os.contains("windows")) {
    try {
      DataPath localDataPath=JDataPathSystem.getLocalSystem().getLocalDataPath("Google");
      dataDir=new File(new File(fixWindowsUnicodePath(localDataPath.getPath())),"Refine");
    }
 catch (    Error e) {
      logger.warn("Failed to use jdatapath to detect user data path: resorting to environment variables");
      File parentDir=null;
      String appData=System.getenv("APPDATA");
      if (appData != null && appData.length() > 0) {
        parentDir=new File(appData);
      }
 else {
        String userProfile=System.getenv("USERPROFILE");
        if (userProfile != null && userProfile.length() > 0) {
          parentDir=new File(userProfile);
        }
      }
      if (parentDir == null) {
        parentDir=new File(".");
      }
      dataDir=new File(new File(parentDir,"Google"),"Refine");
    }
  }
 else   if (os.contains("mac os x")) {
    String home=System.getProperty("user.home");
    String data_home=(home != null) ? home + "/Library/Application Support/Google/Refine" : ".google-refine";
    dataDir=new File(data_home);
  }
 else {
    String data_home=System.getenv("XDG_DATA_HOME");
    if (data_home == null) {
      String home=System.getProperty("user.home");
      if (home == null)       home=".";
      data_home=home + "/.local/share";
    }
    dataDir=new File(data_home + "/google-refine");
  }
  if (!dataDir.exists()) {
    File gridworksDir;
    if (dataDir.getName().equals("Refine")) {
      gridworksDir=new File(dataDir.getParentFile().getParentFile(),"Gridworks");
    }
 else     if (dataDir.getName().startsWith(".")) {
      gridworksDir=new File(dataDir.getParent(),".gridworks");
    }
 else {
      gridworksDir=new File(dataDir.getParent(),".gridworks");
    }
    if (gridworksDir.exists()) {
      gridworksDir.renameTo(dataDir);
    }
 else {
      dataDir.mkdirs();
    }
  }
  return dataDir.getAbsolutePath();
}
