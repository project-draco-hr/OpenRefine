{
  try {
    String queryString=request.getQueryString();
    if (queryString == null) {
      respond(response,"401 Unauthorized","Authentication failed.");
      return;
    }
    String onetimeUseToken=AuthSubUtil.getTokenFromReply(URLDecoder.decode(queryString));
    String sessionToken=AuthSubUtil.exchangeForSessionToken(onetimeUseToken,null);
    TokenCookie.setToken(request,response,sessionToken);
    respond(response,"200 OK","");
  }
 catch (  Exception e) {
    e.printStackTrace();
    TokenCookie.deleteToken(request,response);
    respondException(response,e);
  }
}
