{
  try {
    InputStream is=new FileInputStream(file);
    try {
      Reader reader=encoding != null ? new InputStreamReader(is,encoding) : new InputStreamReader(is);
      int totalBytes=0;
      int openBraces=0;
      int closeBraces=0;
      int openAngleBrackets=0;
      int closeAngleBrackets=0;
      char[] chars=new char[4096];
      int c;
      while (totalBytes < 64 * 1024 && (c=reader.read(chars)) > 0) {
        String chunk=String.valueOf(chars,0,c);
        openBraces+=countSubstrings(chunk,"{");
        closeBraces+=countSubstrings(chunk,"}");
        openAngleBrackets+=countSubstrings(chunk,"<");
        closeAngleBrackets+=countSubstrings(chunk,">");
        totalBytes+=c;
      }
      if (openBraces >= 5 && closeBraces >= 5) {
        return "text/json";
      }
 else       if (openAngleBrackets >= 5 && closeAngleBrackets >= 5) {
        return "text/xml";
      }
 else {
        return "text/line-based";
      }
    }
  finally {
      is.close();
    }
  }
 catch (  UnsupportedEncodingException e) {
    e.printStackTrace();
  }
catch (  IOException e) {
    e.printStackTrace();
  }
  return null;
}
