{
  try {
    Project project=getProject(request);
    ProjectManager.singleton.ensureProjectSaved(project.id);
    response.setHeader("Content-Type","application/x-gzip");
    OutputStream os=response.getOutputStream();
    try {
      gzipTarToOutputStream(ProjectManager.singleton.getProjectDir(project.id),os);
    }
  finally {
      os.close();
    }
  }
 catch (  Exception e) {
    respondException(response,e);
  }
}
