{
  String type=parameters.getProperty("docType");
  String urlString=parameters.getProperty("docUrl");
  boolean isPublic="true".equals(parameters.getProperty("isPublic"));
  String token=isPublic ? null : TokenCookie.getToken(request);
  URL url=new URL(urlString);
  try {
    JSONObject result=new JSONObject();
    JSONObject options=new JSONObject();
    JSONUtilities.safePut(result,"status","ok");
    JSONUtilities.safePut(result,"options",options);
    JSONUtilities.safePut(options,"skipDataLines",0);
    JSONUtilities.safePut(options,"storeBlankRows",true);
    JSONUtilities.safePut(options,"storeBlankCellsAsNulls",true);
    if ("spreadsheet".equals(type)) {
      JSONUtilities.safePut(options,"ignoreLines",-1);
      JSONUtilities.safePut(options,"headerLines",1);
      JSONArray worksheets=new JSONArray();
      JSONUtilities.safePut(options,"worksheets",worksheets);
      SpreadsheetService spreadsheetService=GDataExtension.getSpreadsheetService(token);
      List<WorksheetEntry> worksheetEntries;
      if (token == null) {
        String visibility="public";
        FeedURLFactory factory=FeedURLFactory.getDefault();
        String key=GDataExtension.getSpreadsheetID(url);
        url=factory.getWorksheetFeedUrl(key,visibility,"values");
        WorksheetFeed feed=spreadsheetService.getFeed(url,WorksheetFeed.class);
        worksheetEntries=feed.getEntries();
      }
 else {
        SpreadsheetEntry spreadsheetEntry=spreadsheetService.getEntry(url,SpreadsheetEntry.class);
        worksheetEntries=spreadsheetEntry.getWorksheets();
      }
      for (      WorksheetEntry worksheetEntry : worksheetEntries) {
        JSONObject worksheetO=new JSONObject();
        JSONUtilities.safePut(worksheetO,"name",worksheetEntry.getTitle().getPlainText());
        JSONUtilities.safePut(worksheetO,"rows",worksheetEntry.getRowCount());
        JSONUtilities.safePut(worksheetO,"link",worksheetEntry.getSelfLink().getHref());
        JSONUtilities.append(worksheets,worksheetO);
      }
    }
 else     if ("table".equals(type)) {
    }
    HttpUtilities.respond(response,result.toString());
  }
 catch (  ServiceException e) {
    e.printStackTrace();
    HttpUtilities.respond(response,"error","Internal error: " + e.getLocalizedMessage());
  }
}
