{
  String token=TokenCookie.getToken(request);
  if (token == null) {
    HttpUtilities.respond(response,"error","Not authorized");
    return;
  }
  Writer w=response.getWriter();
  JSONWriter writer=new JSONWriter(w);
  try {
    writer.object();
    writer.key("documents");
    writer.array();
    try {
      DocsService service=GDataExtension.getDocsService(token);
      listSpreadsheets(service,writer);
      listDocumentsOfType(service,writer,"http://schemas.google.com/docs/2007#table");
    }
 catch (    ServiceException e) {
    }
    writer.endArray();
    writer.endObject();
  }
 catch (  JSONException e) {
    throw new ServletException(e);
  }
 finally {
    w.flush();
    w.close();
  }
}
