{
  try {
    Project project=getProject(request);
    Engine engine=getEngine(request,project);
    String format=request.getParameter("format");
    Exporter exporter=s_formatToExporter.get(format.toLowerCase());
    if (exporter == null) {
      exporter=new TsvExporter();
    }
    response.setCharacterEncoding("UTF-8");
    response.setHeader("Content-Type",exporter.getContentType());
    if (exporter.takeWriter()) {
      PrintWriter writer=response.getWriter();
      exporter.export(project,new Properties(),engine,writer);
    }
 else {
      exporter.export(project,new Properties(),engine,response.getOutputStream());
    }
  }
 catch (  Exception e) {
    respondException(response,e);
  }
}
