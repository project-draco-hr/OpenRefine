{
  Token[] initialTokens=innerTokenizer.tokenize(input);
  List<Token> tokens=new ArrayList<Token>();
  for (int i=0; i < initialTokens.length; i++) {
    String str=initialTokens[i].getValue();
    if (keepOldTokens)     tokens.add(intern(str));
    for (int lo=0; lo < str.length(); lo++) {
      for (int len=minNGramSize; len <= maxNGramSize; len++) {
        if (lo + len < str.length()) {
          tokens.add(innerTokenizer.intern(str.substring(lo,lo + len)));
        }
      }
    }
  }
  return (Token[])tokens.toArray(new BasicToken[tokens.size()]);
}
