{
  VPTree tree=buildVPTree();
  if (DEBUG) {
    System.out.println();
    printNode(tree.getRoot(),0);
    System.out.println();
  }
  VPTreeSeeker seeker=new VPTreeSeeker(distance,tree);
  Map<Serializable,Boolean> flags=new HashMap<Serializable,Boolean>();
  for (  Node n : nodes) {
    flags.put(n.get(),true);
  }
  Map<Serializable,Set<Serializable>> map=new HashMap<Serializable,Set<Serializable>>();
  for (  Node n : nodes) {
    Serializable s=n.get();
    if (flags.get(s)) {
      Set<Serializable> results=seeker.range(s,radius);
      results.add(s);
      for (      Serializable ss : results) {
        flags.put(ss,false);
      }
      map.put(s,results);
    }
  }
  return map;
}
